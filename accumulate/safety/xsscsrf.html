<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>谈谈XSS与CSRF | 个人主页</title>
    <meta name="generator" content="VuePress 1.9.10">
    <link rel="icon" href="/images/photo.jpg">
    <link rel="manifest" href="/images/photo.jpg">
    <link rel="apple-touch-icon" href="/images/photo.jpg">
    <meta name="description" content="我的个人网站">
    <meta http-quiv="pragma" cotent="no-cache">
    <meta http-quiv="pragma" cotent="no-cache,must-revalidate">
    <meta http-quiv="expires" cotent="0">
    
    <link rel="preload" href="/assets/css/0.styles.8f3dca9f.css" as="style"><link rel="preload" href="/assets/js/app.e6d790d2.js" as="script"><link rel="preload" href="/assets/js/2.670a8c78.js" as="script"><link rel="preload" href="/assets/js/1.71926bfe.js" as="script"><link rel="preload" href="/assets/js/38.24d3a67d.js" as="script"><link rel="prefetch" href="/assets/js/10.66b9053d.js"><link rel="prefetch" href="/assets/js/11.04545941.js"><link rel="prefetch" href="/assets/js/12.1bdea263.js"><link rel="prefetch" href="/assets/js/13.9426da25.js"><link rel="prefetch" href="/assets/js/14.856c1518.js"><link rel="prefetch" href="/assets/js/15.b360c35b.js"><link rel="prefetch" href="/assets/js/16.e925b239.js"><link rel="prefetch" href="/assets/js/17.5b873df7.js"><link rel="prefetch" href="/assets/js/18.4c170722.js"><link rel="prefetch" href="/assets/js/19.a45744ea.js"><link rel="prefetch" href="/assets/js/20.e4646aa0.js"><link rel="prefetch" href="/assets/js/21.a45f0526.js"><link rel="prefetch" href="/assets/js/22.49faaeca.js"><link rel="prefetch" href="/assets/js/23.c2b62dee.js"><link rel="prefetch" href="/assets/js/24.637d604b.js"><link rel="prefetch" href="/assets/js/25.1370aa75.js"><link rel="prefetch" href="/assets/js/26.254ee0fc.js"><link rel="prefetch" href="/assets/js/27.09790146.js"><link rel="prefetch" href="/assets/js/28.7e5b1948.js"><link rel="prefetch" href="/assets/js/29.fce874c1.js"><link rel="prefetch" href="/assets/js/3.4db2e19a.js"><link rel="prefetch" href="/assets/js/30.a2fe8eb2.js"><link rel="prefetch" href="/assets/js/31.162506d4.js"><link rel="prefetch" href="/assets/js/32.3cde0674.js"><link rel="prefetch" href="/assets/js/33.d7d3d255.js"><link rel="prefetch" href="/assets/js/34.70bab86a.js"><link rel="prefetch" href="/assets/js/35.e25e2604.js"><link rel="prefetch" href="/assets/js/36.b5fada05.js"><link rel="prefetch" href="/assets/js/37.e2f9bc23.js"><link rel="prefetch" href="/assets/js/39.2b6a21e0.js"><link rel="prefetch" href="/assets/js/4.45665f8a.js"><link rel="prefetch" href="/assets/js/40.d406595a.js"><link rel="prefetch" href="/assets/js/41.917cf6ec.js"><link rel="prefetch" href="/assets/js/42.2a915dbf.js"><link rel="prefetch" href="/assets/js/43.06d233c4.js"><link rel="prefetch" href="/assets/js/44.f41cf9e5.js"><link rel="prefetch" href="/assets/js/45.2f577289.js"><link rel="prefetch" href="/assets/js/46.69e142ff.js"><link rel="prefetch" href="/assets/js/47.6967f1f2.js"><link rel="prefetch" href="/assets/js/48.c42a0925.js"><link rel="prefetch" href="/assets/js/49.396ed3db.js"><link rel="prefetch" href="/assets/js/5.b31b942f.js"><link rel="prefetch" href="/assets/js/50.f9fa87b4.js"><link rel="prefetch" href="/assets/js/51.f5150e72.js"><link rel="prefetch" href="/assets/js/52.5b2e9eb6.js"><link rel="prefetch" href="/assets/js/53.775f3eb1.js"><link rel="prefetch" href="/assets/js/54.af0c3dd1.js"><link rel="prefetch" href="/assets/js/55.062c9831.js"><link rel="prefetch" href="/assets/js/56.3228b669.js"><link rel="prefetch" href="/assets/js/57.3e194052.js"><link rel="prefetch" href="/assets/js/58.0fac8851.js"><link rel="prefetch" href="/assets/js/59.4a2921bc.js"><link rel="prefetch" href="/assets/js/6.4910e764.js"><link rel="prefetch" href="/assets/js/60.aaff0e8d.js"><link rel="prefetch" href="/assets/js/61.4094ca3e.js"><link rel="prefetch" href="/assets/js/62.a4d3e4b0.js"><link rel="prefetch" href="/assets/js/63.90c7781d.js"><link rel="prefetch" href="/assets/js/64.9f28672a.js"><link rel="prefetch" href="/assets/js/65.82d99a34.js"><link rel="prefetch" href="/assets/js/66.4b1a7c79.js"><link rel="prefetch" href="/assets/js/67.cde2a4b8.js"><link rel="prefetch" href="/assets/js/68.7b2ca4b4.js"><link rel="prefetch" href="/assets/js/69.3f6a7106.js"><link rel="prefetch" href="/assets/js/7.c5640ac7.js"><link rel="prefetch" href="/assets/js/70.97a2a772.js"><link rel="prefetch" href="/assets/js/71.35881c3b.js"><link rel="prefetch" href="/assets/js/72.25b350dc.js"><link rel="prefetch" href="/assets/js/73.11c7d3f8.js"><link rel="prefetch" href="/assets/js/74.920a6416.js"><link rel="prefetch" href="/assets/js/vendors~docsearch.5e19b665.js">
    <link rel="stylesheet" href="/assets/css/0.styles.8f3dca9f.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">个人主页</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/accumulate/prepare/" class="nav-link">
  前端基础
</a></div><div class="nav-item"><a href="/algorithm/" class="nav-link">
  算法题库
</a></div><div class="nav-item"><a href="/network/guide/" class="nav-link">
  网络
</a></div><div class="nav-item"><a href="/miniprogram/" class="nav-link">
  小程序
</a></div><div class="nav-item"><a href="/typescript/" class="nav-link">
  typescript
</a></div><div class="nav-item"><a href="/front-end-playground/" class="nav-link">
  前端的进击
</a></div><div class="nav-item"><a href="/others/" class="nav-link">
  其他
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/accumulate/prepare/" class="nav-link">
  前端基础
</a></div><div class="nav-item"><a href="/algorithm/" class="nav-link">
  算法题库
</a></div><div class="nav-item"><a href="/network/guide/" class="nav-link">
  网络
</a></div><div class="nav-item"><a href="/miniprogram/" class="nav-link">
  小程序
</a></div><div class="nav-item"><a href="/typescript/" class="nav-link">
  typescript
</a></div><div class="nav-item"><a href="/front-end-playground/" class="nav-link">
  前端的进击
</a></div><div class="nav-item"><a href="/others/" class="nav-link">
  其他
</a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>准备工作</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/accumulate/prepare/" class="sidebar-link">Introduction</a></li><li><a href="/accumulate/prepare/jsbase.html" class="sidebar-link">js基础</a></li><li><a href="/accumulate/prepare/summary.html" class="sidebar-link">写给自己看的js基础灵魂拷问</a></li><li><a href="/accumulate/prepare/init.html" class="sidebar-link">Vue 原理解析</a></li><li><a href="/accumulate/prepare/jsleetcode.html" class="sidebar-link">学习js数据结构与算法 &amp; 算法图解</a></li><li><a href="/accumulate/prepare/vue3.html" class="sidebar-link">vue3的一些改变</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>安全</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/accumulate/safety/" aria-current="page" class="sidebar-link">Introduction</a></li><li><a href="/accumulate/safety/xsscsrf.html" aria-current="page" class="active sidebar-link">谈谈XSS与CSRF</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/accumulate/safety/xsscsrf.html#xss-跨站脚本攻击" class="sidebar-link">xss 跨站脚本攻击</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/accumulate/safety/xsscsrf.html#输入处理" class="sidebar-link">输入处理</a></li></ul></li><li class="sidebar-sub-header"><a href="/accumulate/safety/xsscsrf.html#xss分类" class="sidebar-link">XSS分类</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/accumulate/safety/xsscsrf.html#存储型xss" class="sidebar-link">存储型XSS</a></li><li class="sidebar-sub-header"><a href="/accumulate/safety/xsscsrf.html#反射型xss" class="sidebar-link">反射型XSS</a></li><li class="sidebar-sub-header"><a href="/accumulate/safety/xsscsrf.html#dom型xss" class="sidebar-link">DOM型XSS</a></li><li class="sidebar-sub-header"><a href="/accumulate/safety/xsscsrf.html#预防xss攻击" class="sidebar-link">预防XSS攻击</a></li></ul></li><li class="sidebar-sub-header"><a href="/accumulate/safety/xsscsrf.html#csrf-跨站请求伪造" class="sidebar-link">csrf 跨站请求伪造</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/accumulate/safety/xsscsrf.html#典型的操作流程" class="sidebar-link">典型的操作流程</a></li><li class="sidebar-sub-header"><a href="/accumulate/safety/xsscsrf.html#常见的攻击类型" class="sidebar-link">常见的攻击类型</a></li><li class="sidebar-sub-header"><a href="/accumulate/safety/xsscsrf.html#csrf的特点" class="sidebar-link">CSRF的特点</a></li><li class="sidebar-sub-header"><a href="/accumulate/safety/xsscsrf.html#防护策略" class="sidebar-link">防护策略</a></li><li class="sidebar-sub-header"><a href="/accumulate/safety/xsscsrf.html#总结" class="sidebar-link">总结</a></li></ul></li></ul></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>编译</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/accumulate/compile/" class="sidebar-link">vue2源码</a></li><li><a href="/accumulate/compile/vdom.html" class="sidebar-link">虚拟dom</a></li><li><a href="/accumulate/compile/parse.html" class="sidebar-link">parse</a></li><li><a href="/accumulate/compile/entrance.html" class="sidebar-link">编译入口</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="谈谈xss与csrf"><a href="#谈谈xss与csrf" class="header-anchor">#</a> 谈谈XSS与CSRF</h1> <h2 id="xss-跨站脚本攻击"><a href="#xss-跨站脚本攻击" class="header-anchor">#</a> xss 跨站脚本攻击</h2> <ul><li>攻击者通过在目标网站上注入恶意脚本，使之在用户的浏览器上运行，利用这些恶意脚本，攻击者可获取用户的敏感信息如<code>cookie、sessionId</code>，是利用了用户相信服务器为基础</li> <li>xss本质是恶意代码未经过过滤，与网站正常代码混淆在一起，直接在用户终端执行，以此获取用户信息，或利用这些信息冒充用户向网站发起恶意请求。</li></ul> <h3 id="输入处理"><a href="#输入处理" class="header-anchor">#</a> 输入处理</h3> <ol><li>来此用户输入的信息做转码处理</li> <li>来自第三方的链接</li> <li>URL参数</li> <li>POST参数</li> <li>Referer</li> <li>Cookie</li></ol> <h2 id="xss分类"><a href="#xss分类" class="header-anchor">#</a> XSS分类</h2> <h3 id="存储型xss"><a href="#存储型xss" class="header-anchor">#</a> 存储型XSS</h3> <p>攻击步骤</p> <ol><li>攻击者将恶意代码提交到目标网站的数据库中</li> <li>用户打开目标网站时，服务器将恶意代码从数据中取出，拼接在HTML返回给浏览器</li> <li>浏览器接受到响应后解析执行，混入其中的恶意代码也被执行</li> <li>恶意代码窃取用户数据发送到攻击这网站，或冒充用户行为</li></ol> <blockquote><p>常见操作于保存数据的网站功能，如论坛发帖、商品评论、用户私信等</p></blockquote> <h3 id="反射型xss"><a href="#反射型xss" class="header-anchor">#</a> 反射型XSS</h3> <p>攻击步骤</p> <ol><li>攻击者构造出特殊的URL，其中包含恶意代码</li> <li>用户打开带有恶意代码的URL时，网站服务端将恶意代码从URL中取出，拼接在HTML中返回给浏览器</li> <li>用户浏览器接受响应解析，恶意代码执行</li> <li>恶意代码窃取用户数据并发送到攻击者网站</li></ol> <blockquote><p>反射型和存储型的区别是，存储型XSS的恶意代码存在数据库中，反射型存在URL中。反射型XSS漏洞常见于通过URL传递参数的功能，如网站搜索、跳转等。</p></blockquote> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token operator">&lt;</span>input type<span class="token operator">=</span>text value<span class="token operator">=</span><span class="token string">&quot;keyword&quot;</span><span class="token operator">/</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>button<span class="token operator">&gt;</span>搜索<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>
  您搜索的关键词是：<span class="token punctuation">{</span><span class="token punctuation">{</span>keyword<span class="token punctuation">}</span><span class="token punctuation">}</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
<span class="token comment">// 点击搜索发送的请求</span>
<span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">http://xxx/search?keyword=&quot;&gt;&lt;script&gt;alert('XSS');&lt;/script&gt;</span><span class="token template-punctuation string">`</span></span>
<span class="token comment">// 服务端解析出请求参数得到 &quot;&gt;&lt;script&gt;alert('XSS');&lt;/script&gt; 返回给用户端</span>
<span class="token operator">&lt;</span>input type<span class="token operator">=</span><span class="token string">&quot;text&quot;</span> value<span class="token operator">=</span><span class="token string">&quot;&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>script<span class="token operator">&gt;</span><span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">'XSS'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>&quot;<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>button<span class="token operator">&gt;</span>搜索<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>
  您搜索的关键词是：&quot;<span class="token operator">&gt;</span><span class="token operator">&lt;</span>script<span class="token operator">&gt;</span><span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">'XSS'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
<span class="token comment">// 还执行了两遍</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><h3 id="dom型xss"><a href="#dom型xss" class="header-anchor">#</a> DOM型XSS</h3> <p>攻击步骤</p> <ol><li>攻击者构造出特殊的URL，其中包含恶意代码</li> <li>用户打开带有恶意代码的URL</li> <li>用户浏览器接受响应解析执行，前端js取出URL中的恶意代码执行</li> <li>恶意代码窃取用户数据并发送到攻击者的网站，或者冒充用户的行为，调用目标网站接口执行攻击者指定的操作。</li></ol> <blockquote><p>DOM 型 XSS 跟前两种 XSS 的区别：DOM 型 XSS 攻击中，取出和执行恶意代码由浏览器端完成，属于前端 JavaScript 自身的安全漏洞，而其他两种 XSS 都属于服务端的安全漏洞
比如在网页中有个输入框，在输入完成之后就会创建一个a标签，并且将输入值作为a标签的属性</p></blockquote> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// html</span>
<span class="token operator">&lt;</span>div <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&quot;link&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>input type<span class="token operator">=</span><span class="token string">&quot;text&quot;</span> <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&quot;user-input&quot;</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>Button <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&quot;submit&quot;</span><span class="token operator">&gt;</span>提交<span class="token operator">&lt;</span><span class="token operator">/</span>Button<span class="token operator">&gt;</span>
<span class="token comment">// js</span>
<span class="token keyword">var</span> <span class="token function-variable function">$</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">selector</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span>selector<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'.submit'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'.link'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> <span class="token string">&quot;&lt;a href='&quot;</span> <span class="token operator">+</span> <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'.user-input'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>value <span class="token operator">+</span> <span class="token string">&quot;'&gt;点我呀&lt;/a&gt;&quot;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>当我输入'onclick=alert('hhh')',就完成了一次简单的xss攻击，a标签就会变成，在使用.innerHTML v-html时候要小心。</p> <p>&lt;a href=&quot;&quot; onclick=&quot;alert(123)&quot; ''=&quot;&quot;&gt;点我呀</p> <h3 id="预防xss攻击"><a href="#预防xss攻击" class="header-anchor">#</a> 预防XSS攻击</h3> <ul><li>转义HTML， 将&amp; &lt; &gt; &quot; ' / 进行转义 跳转链接</li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>'&amp;lt;': '&lt;',
'&amp;gt;': '&gt;',
'&amp;quot;': '&quot;',
'&amp;amp;': '&amp;',
'&amp;#10;': '\n'
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><ul><li>HttpOnly 防止劫取Cookie</li> <li>Content Security Policy
<ul><li>禁止加载外域代码</li> <li>禁止外域提交</li> <li>禁止内联脚本执行</li> <li>禁止未授权脚本执行</li></ul></li> <li>验证码</li> <li>避免使用内联事件，避免拼接HTML，限制输入长度</li></ul> <blockquote><p>设置方式，1. 通过HTTP response header设置 Content-Security-policy 2. 通过meta标签</p><meta http-equiv="Content-security-policy" content="script-src self"><p></p></blockquote> <h2 id="csrf-跨站请求伪造"><a href="#csrf-跨站请求伪造" class="header-anchor">#</a> csrf 跨站请求伪造</h2> <p>攻击者诱导受害者进入第三方网站，在第三方网站中，想被攻击者网站发送跨域请求，利用受害者在被攻击网站的凭证，绕过后台的验证，达到冒充用户对攻击网站操作</p> <h3 id="典型的操作流程"><a href="#典型的操作流程" class="header-anchor">#</a> 典型的操作流程</h3> <ol><li>用户登录a.com,并保留了登录凭证</li> <li>攻击者引诱受害者访问了b.com</li> <li>b.com向a.com发送了一个请求，a.com/act=xx，浏览器会默认带上a.com的Cookie</li> <li>a.com收到请求之后，对请求进行验证，并确认是受害者的凭证，误认为是用户发送给自己的请求</li> <li>a.com已正常用户的名义执行了act=xxx</li> <li>攻击完成。攻击者在用户不知情的情况下冒充正常用户执行了自定义操作</li></ol> <h3 id="常见的攻击类型"><a href="#常见的攻击类型" class="header-anchor">#</a> 常见的攻击类型</h3> <h4 id="get类型的csrf"><a href="#get类型的csrf" class="header-anchor">#</a> GET类型的CSRF</h4> <p>在受害者访问这个含有img的页面后，浏览器会发出一次请求，这样就收到了一次跨域请求</p> <h4 id="post类型csrf"><a href="#post类型csrf" class="header-anchor">#</a> POST类型CSRF</h4> <p>攻击者自动构造出一个表单进行自动提交</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code> <span class="token operator">&lt;</span>form action<span class="token operator">=</span><span class="token string">&quot;http://bank.example/withdraw&quot;</span> method<span class="token operator">=</span><span class="token constant">POST</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>input type<span class="token operator">=</span><span class="token string">&quot;hidden&quot;</span> name<span class="token operator">=</span><span class="token string">&quot;account&quot;</span> value<span class="token operator">=</span><span class="token string">&quot;xiaoming&quot;</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>input type<span class="token operator">=</span><span class="token string">&quot;hidden&quot;</span> name<span class="token operator">=</span><span class="token string">&quot;amount&quot;</span> value<span class="token operator">=</span><span class="token string">&quot;10000&quot;</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>input type<span class="token operator">=</span><span class="token string">&quot;hidden&quot;</span> name<span class="token operator">=</span><span class="token string">&quot;for&quot;</span> value<span class="token operator">=</span><span class="token string">&quot;hacker&quot;</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>form<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>script<span class="token operator">&gt;</span> document<span class="token punctuation">.</span>forms<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">submit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span> 
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h4 id="链接类型的csrf"><a href="#链接类型的csrf" class="header-anchor">#</a> 链接类型的CSRF</h4> <p>这种类型通常是在论坛中发布的图片中嵌入恶意链接，或者以广告的形式诱导用户中招</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token operator">&lt;</span>a href<span class="token operator">=</span><span class="token string">&quot;http://test.com/csrf/withdraw.php?amount=1000&amp;for=hacker&quot;</span> taget<span class="token operator">=</span><span class="token string">&quot;_blank&quot;</span><span class="token operator">&gt;</span>
  重磅消息！！
<span class="token operator">&lt;</span>a<span class="token operator">/</span><span class="token operator">&gt;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h3 id="csrf的特点"><a href="#csrf的特点" class="header-anchor">#</a> CSRF的特点</h3> <ol><li>攻击一版发生在第三方网站，而不是目标网站</li> <li>攻击利用受害者的登录凭证，冒充受害者提交请求，而不是直接窃取数据</li> <li>整个过程攻击者并不能获取到受害者的登录凭证，仅仅是“冒用”</li> <li>跨站请求可以用各种方式：图片URL、超链接、CORS、Form提交等等。部分请求方式可以直接嵌入在第三方论坛、文章中，难以进行追踪</li> <li>CSRF通常是跨域的，因为外域通常更容易被攻击者掌控</li></ol> <h3 id="防护策略"><a href="#防护策略" class="header-anchor">#</a> 防护策略</h3> <ul><li>阻止不明外域的访问
<ul><li>同源检测
<ul><li>Origin Header</li> <li>Referer Header</li></ul></li> <li>Samesite Cookie
<ul><li>在Set-Cooloe响应头增加Samesite属性， strict 表示这个cookie不能作为任何第三方cookie，</li> <li>Lax表示 打开了新页面并且是GET请求，则可以作为第三方cookie, 那么其他网站通过页面跳转过来的时候可以使用Cookie，可以保障外域连接打开页面时用户的登录状态</li> <li>缺点： 不支持子域</li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code>Set<span class="token operator">-</span>Cookie<span class="token operator">:</span> foo<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span> Samesite<span class="token operator">=</span>Strict
Set<span class="token operator">-</span>Cookie<span class="token operator">:</span> bar<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">;</span> Samesite<span class="token operator">=</span>Lax
Set<span class="token operator">-</span>Cookie<span class="token operator">:</span> baz<span class="token operator">=</span><span class="token number">3</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div></li> <li>Referrer Policy
<ul><li>头部mete 设置<code>heep-equiv=&quot;Content-Security-policy&quot;</code></li> <li>rep header 进行设置</li></ul></li></ul></li> <li>提交时要求附加本域才能获取的信息
<ul><li>CSRF Token</li> <li>双重Cookie验证</li></ul></li></ul> <h3 id="总结"><a href="#总结" class="header-anchor">#</a> 总结</h3> <ul><li>CSRF自动防御策略：同源检测（Origin 和 Referer 验证）。</li> <li>CSRF主动防御措施：Token验证 或者 双重Cookie验证 以及配合Samesite Cookie。</li> <li>保证页面的幂等性，后端接口不要在GET页面中做用户操作。</li></ul> <p><a href="https://tech.meituan.com/2018/10/11/fe-security-csrf.html" target="_blank" rel="noopener noreferrer">参考链接<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">上次更新:</span> <span class="time">5/19/2021, 5:03:22 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/accumulate/safety/" class="prev router-link-active">
        Introduction
      </a></span> <span class="next"><a href="/accumulate/compile/">
        vue2源码
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.e6d790d2.js" defer></script><script src="/assets/js/2.670a8c78.js" defer></script><script src="/assets/js/1.71926bfe.js" defer></script><script src="/assets/js/38.24d3a67d.js" defer></script>
  </body>
</html>
