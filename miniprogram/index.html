<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>小程序 | 个人主页</title>
    <meta name="generator" content="VuePress 1.9.10">
    <link rel="icon" href="/images/photo.jpg">
    <link rel="manifest" href="/images/photo.jpg">
    <link rel="apple-touch-icon" href="/images/photo.jpg">
    <meta name="description" content="我的个人网站">
    <meta http-quiv="pragma" cotent="no-cache">
    <meta http-quiv="pragma" cotent="no-cache,must-revalidate">
    <meta http-quiv="expires" cotent="0">
    
    <link rel="preload" href="/assets/css/0.styles.8f3dca9f.css" as="style"><link rel="preload" href="/assets/js/app.e6d790d2.js" as="script"><link rel="preload" href="/assets/js/2.670a8c78.js" as="script"><link rel="preload" href="/assets/js/1.71926bfe.js" as="script"><link rel="preload" href="/assets/js/58.0fac8851.js" as="script"><link rel="prefetch" href="/assets/js/10.66b9053d.js"><link rel="prefetch" href="/assets/js/11.04545941.js"><link rel="prefetch" href="/assets/js/12.1bdea263.js"><link rel="prefetch" href="/assets/js/13.9426da25.js"><link rel="prefetch" href="/assets/js/14.856c1518.js"><link rel="prefetch" href="/assets/js/15.b360c35b.js"><link rel="prefetch" href="/assets/js/16.e925b239.js"><link rel="prefetch" href="/assets/js/17.5b873df7.js"><link rel="prefetch" href="/assets/js/18.4c170722.js"><link rel="prefetch" href="/assets/js/19.a45744ea.js"><link rel="prefetch" href="/assets/js/20.e4646aa0.js"><link rel="prefetch" href="/assets/js/21.a45f0526.js"><link rel="prefetch" href="/assets/js/22.49faaeca.js"><link rel="prefetch" href="/assets/js/23.c2b62dee.js"><link rel="prefetch" href="/assets/js/24.637d604b.js"><link rel="prefetch" href="/assets/js/25.1370aa75.js"><link rel="prefetch" href="/assets/js/26.254ee0fc.js"><link rel="prefetch" href="/assets/js/27.09790146.js"><link rel="prefetch" href="/assets/js/28.7e5b1948.js"><link rel="prefetch" href="/assets/js/29.fce874c1.js"><link rel="prefetch" href="/assets/js/3.4db2e19a.js"><link rel="prefetch" href="/assets/js/30.a2fe8eb2.js"><link rel="prefetch" href="/assets/js/31.162506d4.js"><link rel="prefetch" href="/assets/js/32.3cde0674.js"><link rel="prefetch" href="/assets/js/33.d7d3d255.js"><link rel="prefetch" href="/assets/js/34.70bab86a.js"><link rel="prefetch" href="/assets/js/35.e25e2604.js"><link rel="prefetch" href="/assets/js/36.b5fada05.js"><link rel="prefetch" href="/assets/js/37.e2f9bc23.js"><link rel="prefetch" href="/assets/js/38.24d3a67d.js"><link rel="prefetch" href="/assets/js/39.2b6a21e0.js"><link rel="prefetch" href="/assets/js/4.45665f8a.js"><link rel="prefetch" href="/assets/js/40.d406595a.js"><link rel="prefetch" href="/assets/js/41.917cf6ec.js"><link rel="prefetch" href="/assets/js/42.2a915dbf.js"><link rel="prefetch" href="/assets/js/43.06d233c4.js"><link rel="prefetch" href="/assets/js/44.f41cf9e5.js"><link rel="prefetch" href="/assets/js/45.2f577289.js"><link rel="prefetch" href="/assets/js/46.69e142ff.js"><link rel="prefetch" href="/assets/js/47.6967f1f2.js"><link rel="prefetch" href="/assets/js/48.c42a0925.js"><link rel="prefetch" href="/assets/js/49.396ed3db.js"><link rel="prefetch" href="/assets/js/5.b31b942f.js"><link rel="prefetch" href="/assets/js/50.f9fa87b4.js"><link rel="prefetch" href="/assets/js/51.f5150e72.js"><link rel="prefetch" href="/assets/js/52.5b2e9eb6.js"><link rel="prefetch" href="/assets/js/53.775f3eb1.js"><link rel="prefetch" href="/assets/js/54.af0c3dd1.js"><link rel="prefetch" href="/assets/js/55.062c9831.js"><link rel="prefetch" href="/assets/js/56.3228b669.js"><link rel="prefetch" href="/assets/js/57.3e194052.js"><link rel="prefetch" href="/assets/js/59.4a2921bc.js"><link rel="prefetch" href="/assets/js/6.4910e764.js"><link rel="prefetch" href="/assets/js/60.aaff0e8d.js"><link rel="prefetch" href="/assets/js/61.4094ca3e.js"><link rel="prefetch" href="/assets/js/62.a4d3e4b0.js"><link rel="prefetch" href="/assets/js/63.90c7781d.js"><link rel="prefetch" href="/assets/js/64.9f28672a.js"><link rel="prefetch" href="/assets/js/65.82d99a34.js"><link rel="prefetch" href="/assets/js/66.4b1a7c79.js"><link rel="prefetch" href="/assets/js/67.cde2a4b8.js"><link rel="prefetch" href="/assets/js/68.7b2ca4b4.js"><link rel="prefetch" href="/assets/js/69.3f6a7106.js"><link rel="prefetch" href="/assets/js/7.c5640ac7.js"><link rel="prefetch" href="/assets/js/70.97a2a772.js"><link rel="prefetch" href="/assets/js/71.35881c3b.js"><link rel="prefetch" href="/assets/js/72.25b350dc.js"><link rel="prefetch" href="/assets/js/73.11c7d3f8.js"><link rel="prefetch" href="/assets/js/74.920a6416.js"><link rel="prefetch" href="/assets/js/vendors~docsearch.5e19b665.js">
    <link rel="stylesheet" href="/assets/css/0.styles.8f3dca9f.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">个人主页</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/accumulate/prepare/" class="nav-link">
  前端基础
</a></div><div class="nav-item"><a href="/algorithm/" class="nav-link">
  算法题库
</a></div><div class="nav-item"><a href="/network/guide/" class="nav-link">
  网络
</a></div><div class="nav-item"><a href="/miniprogram/" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  小程序
</a></div><div class="nav-item"><a href="/typescript/" class="nav-link">
  typescript
</a></div><div class="nav-item"><a href="/front-end-playground/" class="nav-link">
  前端的进击
</a></div><div class="nav-item"><a href="/others/" class="nav-link">
  其他
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/accumulate/prepare/" class="nav-link">
  前端基础
</a></div><div class="nav-item"><a href="/algorithm/" class="nav-link">
  算法题库
</a></div><div class="nav-item"><a href="/network/guide/" class="nav-link">
  网络
</a></div><div class="nav-item"><a href="/miniprogram/" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  小程序
</a></div><div class="nav-item"><a href="/typescript/" class="nav-link">
  typescript
</a></div><div class="nav-item"><a href="/front-end-playground/" class="nav-link">
  前端的进击
</a></div><div class="nav-item"><a href="/others/" class="nav-link">
  其他
</a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>小程序学习</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/miniprogram/wechat.html" class="sidebar-link">原生小程序</a></li><li><a href="/miniprogram/tora.html" class="sidebar-link">tora</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="小程序"><a href="#小程序" class="header-anchor">#</a> 小程序</h1> <h2 id="jsbridge-特点和前端实现方式"><a href="#jsbridge-特点和前端实现方式" class="header-anchor">#</a> JSBridge 特点和前端实现方式</h2> <h3 id="jsbridge-本质"><a href="#jsbridge-本质" class="header-anchor">#</a> JSBridge 本质</h3> <ol><li>由 Native 约定好 API 的实现方式，JS 端根据约定好的规则去实现，比如 WebView 映射 Native 的方法叫做 JSOriginBridge，那么在 JS 端就需要调用 window 属性上的 JSOriginBridge 来实现通信</li> <li>在 WebView 调用 Native 的几种方式的时候，有说到回调函数的方式，本质上与 Native 通信只能够传简单的数据类型，比如 string 和 number，所以不能被 JSON.stringify 或其他序列化方法转换的数据结构就会丢失，那我们就需要对回调函数处理</li></ol> <h3 id="jsbridge-前端实现"><a href="#jsbridge-前端实现" class="header-anchor">#</a> JSBridge 前端实现</h3> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> isAndroid <span class="token operator">=</span> window<span class="token punctuation">.</span>navigator<span class="token punctuation">.</span>userAgent<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token string">'Android'</span><span class="token punctuation">)</span> <span class="token operator">!==</span> <span class="token operator">-</span><span class="token number">1</span>
​
 <span class="token keyword">function</span> <span class="token function">possNativeMessage</span><span class="token punctuation">(</span><span class="token parameter">message</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>isAndroid<span class="token punctuation">)</span><span class="token punctuation">{</span>
        window<span class="token punctuation">.</span>JSOriginBridge<span class="token punctuation">.</span><span class="token function">postMessage</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token punctuation">{</span>
        window<span class="token punctuation">.</span>webkit<span class="token punctuation">.</span>messageHandlers<span class="token punctuation">.</span>JSOriginBridge<span class="token punctuation">.</span><span class="token function">postMessage</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
​
<span class="token comment">/* 向 Native 发布事件 */</span>
<span class="token keyword">function</span> <span class="token function">publishNativeMessage</span><span class="token punctuation">(</span><span class="token parameter">params</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">const</span> message <span class="token operator">=</span> <span class="token punctuation">{</span>
        eventType<span class="token operator">:</span><span class="token string">'publish'</span><span class="token punctuation">,</span>
        data<span class="token operator">:</span>params
    <span class="token punctuation">}</span>
    <span class="token function">possNativeMessage</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
​
<span class="token comment">/* 触发 Native 方法, 触发回调函数 */</span>
<span class="token keyword">function</span> <span class="token function">invokeNativeEvent</span><span class="token punctuation">(</span><span class="token parameter">name<span class="token punctuation">,</span>params<span class="token punctuation">,</span>callbackId</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">const</span> message <span class="token operator">=</span> <span class="token punctuation">{</span>
        eventType<span class="token operator">:</span><span class="token string">'invoke'</span><span class="token punctuation">,</span>
        type<span class="token operator">:</span>name<span class="token punctuation">,</span>
        data<span class="token operator">:</span>params<span class="token punctuation">,</span>
        callbackId
    <span class="token punctuation">}</span>
    <span class="token function">possNativeMessage</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
​
<span class="token keyword">class</span> <span class="token class-name">JSBridge</span> <span class="token punctuation">{</span>
    <span class="token comment">/* 保存 */</span>
    eventHandlers <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Map</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    responseCallbacks <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Map</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    callbackID <span class="token operator">=</span> <span class="token number">0</span>
    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        window<span class="token punctuation">.</span>_handleNativeCallback <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">handleNativeCallback</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span>
        window<span class="token punctuation">.</span>_handleNativeEvent <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">handleNativeEvent</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token comment">/* 向 native 发送消息 */</span>
    <span class="token function">postMessage</span><span class="token punctuation">(</span><span class="token parameter">params</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">const</span> data <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>params<span class="token punctuation">)</span>
        <span class="token function">publishNativeMessage</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
     <span class="token comment">/* 向 native 发送消息,等待回调函数 */</span>
    <span class="token function">invoke</span><span class="token punctuation">(</span><span class="token parameter">name<span class="token punctuation">,</span>payload<span class="token punctuation">,</span>callback</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>callbackID<span class="token operator">++</span>
        <span class="token comment">/* 将回调函数保存起来 */</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>responseCallbacks<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>callbackID<span class="token punctuation">,</span>callback<span class="token punctuation">)</span>
        <span class="token function">invokeNativeEvent</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span>payload<span class="token punctuation">,</span><span class="token keyword">this</span><span class="token punctuation">.</span>callbackID<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token comment">/* 
    处理 native 调用 window 上的 _handleNativeCallback 方法。
    当执行 invoke 回调的时候，执行该方法
    */</span>
    <span class="token function">handleNativeCallback</span><span class="token punctuation">(</span><span class="token parameter">jsonResponse</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">const</span> res <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>jsonResponse<span class="token punctuation">)</span>
        <span class="token keyword">const</span> <span class="token punctuation">{</span> callbackID<span class="token punctuation">,</span><span class="token operator">...</span>params <span class="token punctuation">}</span> <span class="token operator">=</span> res
        <span class="token keyword">const</span> callback <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>responseCallbacks<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>callbackID<span class="token punctuation">)</span>
        <span class="token comment">/* 取出回调函数并且执行 */</span>
        callback <span class="token operator">&amp;&amp;</span> <span class="token function">callback</span><span class="token punctuation">(</span>params<span class="token punctuation">)</span>
        <span class="token comment">/* 删除对应的回调函数 */</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>responseCallbacks<span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span>callbackID<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token comment">/* 
     处理 native 调用 window 上的 _handleNativeEvent 方法。
     处理绑定在 native 的事件
     */</span>
    <span class="token function">handleNativeEvent</span><span class="token punctuation">(</span><span class="token parameter">jsonResponse</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">const</span> res <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>jsonResponse<span class="token punctuation">)</span>
        <span class="token keyword">const</span> <span class="token punctuation">{</span> eventName<span class="token punctuation">,</span><span class="token operator">...</span>params <span class="token punctuation">}</span> <span class="token operator">=</span> res
        <span class="token keyword">const</span> callback <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>eventHandlers<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>eventName<span class="token punctuation">)</span>
        <span class="token function">callback</span><span class="token punctuation">(</span>params<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token comment">/* 绑定注册事件 */</span>
    <span class="token function">registerEvent</span><span class="token punctuation">(</span><span class="token parameter">name<span class="token punctuation">,</span>callback</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>eventHandlers<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span>callback<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token comment">/* 解绑事件 */</span>
    <span class="token function">unRegisterEvent</span><span class="token punctuation">(</span><span class="token parameter">name</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>eventHandlers<span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
​
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">new</span> <span class="token class-name">JSBridge</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br></div></div><ul><li>发布事件 <code>(publishNativeMessage)</code> <ul><li>当网页想要通知原生应用某件事情发生时，它会&quot;发布&quot;一个事件。这不需要原生应用立即给出响应。发布事件类似于广播一个消息，原生应用可以根据自己的需要来处理这个消息。</li> <li>例如，如果你有一个按钮在网页上，当用户点击这个按钮时，你可能想告诉原生应用用户已经开始一个特定的动作，比如开始播放视频。这时，你就会发布一个事件，原生应用接收到这个事件后，可能会执行一些相关的逻辑，比如记录用户行为、调整应用状态等。</li></ul></li> <li>调用原生事件 <code>(invokeNativeEvent)</code> <ul><li>当网页需要原生应用执行某个操作并且对这个操作的结果感兴趣时，它会&quot;调用&quot;一个原生事件。这通常涉及到一个回调函数，网页端在调用原生事件时提供一个回调函数的 <code>ID (callbackID)</code>，原生应用执行完相应的操作后，会调用这个回调函数并传递结果回网页端。</li> <li>例如，如果网页需要获取用户的地理位置信息，它可以调用一个原生事件来请求这些信息。因为获取位置信息可能需要一些时间，原生应用会在操作完成后通过回调函数将位置信息发送回网页。</li></ul></li> <li>关于<code>handleNativeEvent</code> <ul><li>接收原生事件: 原生应用通过调用网页上的全局函数 _handleNativeEvent 来触发一个事件。这个函数实际上是 <code>JSBridge</code> 类中 `handleNativeEvent`` 方法的引用。</li> <li>客户端和js两边，约定协议，开发者需要在网页端和原生应用端定义一个共同的事件列表</li> <li>假设原生应用在用户完成某项操作时想通知网页（比如用户完成了一个支付流程），原生应用会调用 <code>_handleNativeEvent</code> 函数并传递相关事件信息。网页端可能已经注册了一个处理支付完成的事件处理函数，handleNativeEvent 方法会找到这个函数并执行它，同时传递支付详情作为参数。</li> <li>网页端注册事件处理函数</li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code>JSBridge<span class="token punctuation">.</span><span class="token function">registerEvent</span><span class="token punctuation">(</span><span class="token string">'paymentCompleted'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 处理支付完成的逻辑</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><ul><li>触发事件： 原生应用在用户完成支付后需要通知网页端时，它会根据约定的协议构造一个事件对象，并调用网页上的 <code>_handleNativeEvent</code> 方法。事件对象会包含事件名称     <code>paymentCompleted</code> 和相关的支付详情。</li> <li>网页端处理事件: 网页端的 <code>handleNativeEvent</code> 方法会被调用，它解析传递过来的事件对象，找到事件名称对应的处理函数，并执行它，传递支付详情作为参数。</li></ul></li></ul> <h2 id="小程序通信方式及通信细节"><a href="#小程序通信方式及通信细节" class="header-anchor">#</a> 小程序通信方式及通信细节</h2> <blockquote><p>通信方案就是数据从逻辑层的 JS 传递给 Native 层，再由 Native 层传递到 WebView 的 JS 层，然后再渲染视图，这期间数据需要经过序列化和反序列化，并且需要两次桥通信。</p></blockquote> <h2 id="小程序启动流程及性能分析"><a href="#小程序启动流程及性能分析" class="header-anchor">#</a> 小程序启动流程及性能分析</h2> <h2 id="小程序原理"><a href="#小程序原理" class="header-anchor">#</a> 小程序原理</h2> <h2 id="小程序优化"><a href="#小程序优化" class="header-anchor">#</a> 小程序优化</h2> <h2 id="小程序开发技巧"><a href="#小程序开发技巧" class="header-anchor">#</a> 小程序开发技巧</h2></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">上次更新:</span> <span class="time">4/12/2024, 6:00:38 PM</span></div></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.e6d790d2.js" defer></script><script src="/assets/js/2.670a8c78.js" defer></script><script src="/assets/js/1.71926bfe.js" defer></script><script src="/assets/js/58.0fac8851.js" defer></script>
  </body>
</html>
